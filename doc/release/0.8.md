# Test

- Use [anyio](https://anyio.readthedocs.io) auto mode
- Add sensor node test to print Base64 encoded MAC address (used as Bluetooth name) and then renames the node to this name:

  ```sh
  icotest run -k 'sensor_node and base64'
  ```

- We now store the sensor node name in the metadata of the test for the Base64 encoded MAC address. To produce the JSON metadata, please add the option `--json-report` to the test command:

  ```sh
  icotest run --json-report -k 'sensor_node and base64'
  ```

  After this command finished successfully there should be a file `.report.json` in the current working directory that stores the name in an object with the key `Sensor Node Name`. For the example above you can print the name using the following [`yq`](https://github.com/mikefarah/yq) command:

  ```sh
  yq '.tests[0].metadata.["Sensor Node Name"]' .report.json
  ```

- Add support for uploading multiple flash images via the configuration values:
  - `sensor node` → `firmware` → `locations` and
  - `STU` → `firmware` → `locations`.

  Please note that we changed the configuration key from the singular `location` to the plural **`locations`** to reflect that `locations` contain a list instead of a scalar value (like `location` used to)!

  If you want to adapt the user configuration for your target and **you enabled merging with `dynaconf_merge: true`** in your user configuration file, then please **do not forget to set `dynaconf_merge: false` for the locations value**:

  ```yaml
  dynaconf_merge: true

  # …

  sensor node:
    firmware:
      dynaconf_merge: false
      # …
      locations:
        - filepath_first_firmware_image.s37
        - filepath_second_firmware_image.s37
  ```

  Otherwise the default locations and your configuration values will be merged instead of overwritten.
